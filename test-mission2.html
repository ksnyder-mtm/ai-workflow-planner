<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission 2 Test - Pain Points Navigation</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #1c487b;
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
            max-width: 400px;
            min-width: 300px;
        }
        .debug-step {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        .test-btn {
            background: #f18f38;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .debug-info {
            font-size: 11px;
            color: #1ab1d2;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h4>üîç Mission 2 Debug Panel</h4>
        <div id="status">Starting...</div>
        
        <div class="debug-step">
            <strong>Current State:</strong>
            <div class="debug-info" id="currentState">Initializing...</div>
        </div>
        
        <div class="debug-step">
            <strong>Pain Points:</strong>
            <div class="debug-info" id="painPointsInfo">None</div>
        </div>
        
        <div class="debug-step">
            <strong>Validation:</strong>
            <div class="debug-info" id="validationInfo">Unknown</div>
        </div>
        
        <button class="test-btn" onclick="runMission2Test()">Run Full Test</button>
        <button class="test-btn" onclick="checkValidation()">Check Validation</button>
        <button class="test-btn" onclick="checkButtons()">Check Buttons</button>
        <button class="test-btn" onclick="runNavigationTest()">Test Navigation Fix</button>
        <button class="test-btn" onclick="reset()">Reset</button>
    </div>

    <div id="app"></div>

    <script src="js/config.js"></script>
    <script src="js/modules/Templates.js"></script>
    <script src="js/modules/UI.js"></script>
    <script src="js/modules/WorkflowMethods.js"></script>
    <script src="js/modules/DragDropHandler.js"></script>
    <script src="js/AIWorkflowDetective.js"></script>
    
    <script>
        let app;
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
            console.log('STATUS:', message);
        }
        
        function updateCurrentState() {
            if (!app) return;
            document.getElementById('currentState').innerHTML = `
                Level: ${app.state.currentLevel}<br>
                Workflow: ${app.state.selectedWorkflow}<br>
                Points: ${app.state.totalPoints}
            `;
        }
        
        function updatePainPointsInfo() {
            if (!app) return;
            document.getElementById('painPointsInfo').innerHTML = `
                Count: ${app.state.painPoints.length}<br>
                Selected: ${app.state.currentPainPointIndex}<br>
                Points: ${app.state.painPoints.map(p => p.text).join('<br>')}
            `;
        }
        
        function updateValidationInfo() {
            if (!app) return;
            const canProceed = app.canProceed();
            const nextBtn = document.getElementById('nextBtn');
            document.getElementById('validationInfo').innerHTML = `
                Can Proceed: ${canProceed ? '‚úÖ' : '‚ùå'}<br>
                Next Btn Disabled: ${nextBtn ? nextBtn.disabled : 'N/A'}<br>
                Current Level Validation: Level ${app.state.currentLevel}
            `;
        }
        
        function updateAllInfo() {
            updateCurrentState();
            updatePainPointsInfo();
            updateValidationInfo();
        }

        document.addEventListener('DOMContentLoaded', function() {
            try {
                app = new AIWorkflowDetective();
                app.init();
                updateStatus('‚úÖ App initialized');
                updateAllInfo();
                window.app = app;
                
                // Update info periodically
                setInterval(updateAllInfo, 1000);
                
            } catch (error) {
                updateStatus(`‚ùå Error: ${error.message}`);
                console.error(error);
            }
        });

        function runMission2Test() {
            updateStatus('üß™ Running Mission 2 test...');
            
            // Go to level 1 (workflow selection)
            app.startDetectiveWork();
            updateStatus('Started detective work');
            
            setTimeout(() => {
                // Select workflow
                app.selectWorkflow('meetings');
                updateStatus('Selected meetings workflow');
                
                setTimeout(() => {
                    // Go to level 2 (pain points)
                    app.nextLevel();
                    updateStatus('Moved to pain points level');
                    
                    setTimeout(() => {
                        // Add a pain point
                        const input = document.getElementById('painPointInput');
                        if (input) {
                            input.value = 'Test pain point - taking notes while presenting';
                            app.addPainPoint();
                            updateStatus('Added pain point');
                            
                            setTimeout(() => {
                                // Select the pain point
                                updateStatus('Selecting pain point...');
                                app.selectPainPoint(0);
                                
                                setTimeout(() => {
                                    updateStatus('Pain point selected! Checking button...');
                                    const nextBtn = document.getElementById('nextBtn');
                                    updateStatus(`Button disabled: ${nextBtn ? nextBtn.disabled : 'N/A'}`);
                                    
                                    // Try to click next
                                    if (nextBtn && !nextBtn.disabled) {
                                        nextBtn.click();
                                        setTimeout(() => {
                                            updateStatus(`‚úÖ SUCCESS! Now at level: ${app.state.currentLevel}`);
                                        }, 500);
                                    } else {
                                        updateStatus('‚ùå FAILED: Button is disabled');
                                    }
                                }, 500);
                            }, 500);
                        } else {
                            updateStatus('‚ùå Pain point input not found');
                        }
                    }, 500);
                }, 500);
            }, 500);
        }
        
        function checkValidation() {
            if (!app) return;
            
            console.log('=== VALIDATION CHECK ===');
            console.log('Current level:', app.state.currentLevel);
            console.log('Pain points:', app.state.painPoints);
            console.log('Selected index:', app.state.currentPainPointIndex);
            console.log('Can proceed:', app.canProceed());
            
            // Manually trigger validation
            const result = app.validateCurrentLevel();
            updateStatus(`Manual validation result: ${result}`);
        }
        
        function checkButtons() {
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            
            updateStatus(`
                Next: ${nextBtn ? 'Found' : 'Missing'} - Disabled: ${nextBtn ? nextBtn.disabled : 'N/A'}<br>
                Prev: ${prevBtn ? 'Found' : 'Missing'} - Disabled: ${prevBtn ? prevBtn.disabled : 'N/A'}
            `);
            
            // Try to manually click the next button if it exists and is enabled
            if (nextBtn && !nextBtn.disabled) {
                updateStatus('Attempting to click next button...');
                try {
                    nextBtn.click();
                    setTimeout(() => {
                        updateStatus(`Button click result - now at level: ${app.state.currentLevel}`);
                    }, 100);
                } catch (error) {
                    updateStatus(`Button click error: ${error.message}`);
                }
            }
        }
        
        function reset() {
            if (app) {
                app.reset();
                updateStatus('Reset complete');
            }
        }

        // Global help function  
        function showHelp(topic) {
            if (app) {
                app.showNotification('Help: ' + topic, 'success');
            }
        }
        
        // Test navigation fix function
        function runNavigationTest() {
            updateStatus('üß™ Testing navigation fix...');
            
            if (!app) {
                updateStatus('‚ùå App not available');
                return;
            }
            
            // Reset app to start fresh
            app.reset();
            updateStatus('App reset');
            
            setTimeout(() => {
                // Start detective work (go to level 1)
                app.startDetectiveWork();
                updateStatus(`Started detective work, level: ${app.state.currentLevel}`);
                
                setTimeout(() => {
                    // Select a workflow
                    app.selectWorkflow('meetings');
                    updateStatus('Selected meetings workflow');
                    
                    setTimeout(() => {
                        // Move to level 2 (pain points)
                        app.nextLevel();
                        updateStatus(`Moved to level: ${app.state.currentLevel}`);
                        
                        setTimeout(() => {
                            // Add a pain point
                            const painPointInput = document.getElementById('painPointInput');
                            if (painPointInput) {
                                painPointInput.value = 'Test pain point - difficult to track meeting action items';
                                app.addPainPoint();
                                updateStatus(`Added pain point, total: ${app.state.painPoints.length}`);
                                
                                setTimeout(() => {
                                    // Select the pain point
                                    app.selectPainPoint(0);
                                    updateStatus(`Selected pain point, index: ${app.state.currentPainPointIndex}`);
                                    
                                    setTimeout(() => {
                                        // Check if we can proceed
                                        const canProceed = app.canProceed();
                                        updateStatus(`Can proceed: ${canProceed}`);
                                        
                                        // Try to move to level 3 (solutions)
                                        const beforeLevel = app.state.currentLevel;
                                        app.nextLevel();
                                        const afterLevel = app.state.currentLevel;
                                        
                                        if (afterLevel === 3) {
                                            updateStatus('‚úÖ SUCCESS: Navigation from Mission 2 to Mission 3 works!');
                                        } else {
                                            updateStatus(`‚ùå FAILED: Still at level ${afterLevel} (was ${beforeLevel})`);
                                        }
                                    }, 500);
                                }, 500);
                            } else {
                                updateStatus('‚ùå Pain point input not found');
                            }
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }
    </script>
</body>
</html>